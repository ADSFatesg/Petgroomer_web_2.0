<div *ngIf="loading" class="global-spinner-container">
  <mat-spinner [diameter]="50"></mat-spinner>
</div>
<div class="register-employee-container">
  <form [formGroup]="employeeForm" (ngSubmit)="onSubmit()">
    <h1>Cadastro de Funcionário</h1>
    <div class="form-sections">

      <!-- Seção 1: Informações Pessoais -->
      <div class="form-section">
        <h3>Informações Pessoais</h3>

        <!-- Campo CPF -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('cpf')?.touched && employeeForm.get('cpf')?.invalid}">
          <label for="cpf">CPF <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">badge</mat-icon>
            <input id="cpf" formControlName="cpf" type="text" placeholder="Digite o CPF" mask="000.000.000-00">
          </div>
          <div *ngIf="employeeForm.get('cpf')?.touched && employeeForm.get('cpf')?.invalid" class="error-message">
            CPF é obrigatório.
          </div>
        </div>

        <!-- Campo Nome -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('name')?.touched && employeeForm.get('name')?.invalid}">
          <label for="name">Nome <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">person</mat-icon>
            <input id="name" formControlName="name" type="text" placeholder="Nome completo">
          </div>
          <div *ngIf="employeeForm.get('name')?.touched && employeeForm.get('name')?.invalid" class="error-message">
            Nome é obrigatório.
          </div>
        </div>

        <!-- Campo Email -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('email')?.touched && employeeForm.get('email')?.invalid}">
          <label for="email">Email <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">email</mat-icon>
            <input id="email" formControlName="email" type="email" placeholder="Email">
          </div>
          <div *ngIf="employeeForm.get('email')?.touched && employeeForm.get('email')?.invalid" class="error-message">
            {{ employeeForm.get('email')?.errors?.['required'] ? 'Email é obrigatório.' : 'Email inválido.' }}
          </div>
        </div>

        <!-- Campo Telefone -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('phone')?.touched && employeeForm.get('phone')?.invalid}">
          <label for="phone">Telefone <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">phone</mat-icon>
            <input id="phone" formControlName="phone" type="text" placeholder="Telefone" mask="(00) 00000-0000">
          </div>
          <div *ngIf="employeeForm.get('phone')?.touched && employeeForm.get('phone')?.invalid" class="error-message">
            Telefone é obrigatório.
          </div>
        </div>
        <div class="form-group"
        [ngClass]="{'has-error': employeeForm.get('password')?.touched && employeeForm.get('password')?.invalid}">
        <label for="password">Senha <span class="required">*</span></label>
        <div class="input-with-icon">
          <input id="password" formControlName="password" [type]="hidePassword ? 'password' : 'text'"
            placeholder="Digite sua senha">
          <button mat-icon-button matSuffix (click)="hidePassword = !hidePassword" type="button">
            <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
          </button>
        </div>
        <div *ngIf="employeeForm.get('password')?.touched && employeeForm.get('password')?.invalid" class="error-message">
          Senha é obrigatória.
        </div>
      </div>
      </div>

      <!-- Seção 2: Endereço -->
      <div class="form-section">
        <h3>Endereço</h3>

        <!-- Campo CEP -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('postalCode')?.touched && employeeForm.get('postalCode')?.invalid}">
          <label for="postalCode">CEP <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">location_on</mat-icon>
            <input id="postalCode" formControlName="postalCode" type="text" placeholder="CEP" mask="00000-000">
            <button type="button" class="btn-icon" (click)="consultarCEP()" tabindex="-1" matTooltip="Consultar CEP">
              <mat-icon>search</mat-icon>
            </button>
          </div>
          <div *ngIf="employeeForm.get('postalCode')?.touched && employeeForm.get('postalCode')?.invalid"
            class="error-message">
            CEP é obrigatório.
          </div>
        </div>

        <!-- Campo Rua -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('street')?.touched && employeeForm.get('street')?.invalid}">
          <label for="street">Rua <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">home</mat-icon>
            <input id="street" formControlName="street" type="text" placeholder="Rua">
          </div>
          <div *ngIf="employeeForm.get('street')?.touched && employeeForm.get('street')?.invalid" class="error-message">
            Rua é obrigatória.
          </div>
        </div>

        <!-- Campo Número -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('number')?.touched && employeeForm.get('number')?.invalid}">
          <label for="number">Número <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">looks_one</mat-icon>
            <input id="number" formControlName="number" type="text" placeholder="Número">
          </div>
          <div *ngIf="employeeForm.get('number')?.touched && employeeForm.get('number')?.invalid" class="error-message">
            Número é obrigatório.
          </div>
        </div>

        <!-- Campo Complemento -->
        <div class="form-group">
          <label for="complement">Complemento</label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">add_location</mat-icon>
            <input id="complement" formControlName="complement" type="text" placeholder="Complemento">
          </div>
        </div>

        <!-- Campo Bairro -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('neighborhood')?.touched && employeeForm.get('neighborhood')?.invalid}">
          <label for="neighborhood">Bairro <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">location_city</mat-icon>
            <input id="neighborhood" formControlName="neighborhood" type="text" placeholder="Bairro">
          </div>
          <div *ngIf="employeeForm.get('neighborhood')?.touched && employeeForm.get('neighborhood')?.invalid"
            class="error-message">
            Bairro é obrigatório.
          </div>
        </div>

        <!-- Campo Cidade -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('city')?.touched && employeeForm.get('city')?.invalid}">
          <label for="city">Cidade <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">location_city</mat-icon>
            <input id="city" formControlName="city" type="text" placeholder="Cidade">
          </div>
          <div *ngIf="employeeForm.get('city')?.touched && employeeForm.get('city')?.invalid" class="error-message">
            Cidade é obrigatória.
          </div>
        </div>

        <!-- Campo Estado -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('state')?.touched && employeeForm.get('state')?.invalid}">
          <label for="state">Estado <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">map</mat-icon>
            <input id="state" formControlName="state" type="text" placeholder="Estado">
          </div>
          <div *ngIf="employeeForm.get('state')?.touched && employeeForm.get('state')?.invalid" class="error-message">
            Estado é obrigatório.
          </div>
        </div>

        <!-- Campo País -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('country')?.touched && employeeForm.get('country')?.invalid}">
          <label for="country">País <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">public</mat-icon>
            <select id="country" formControlName="country">
              <option *ngFor="let country of countries" [value]="country">{{ country }}</option>
            </select>
          </div>
          <div *ngIf="employeeForm.get('country')?.touched && employeeForm.get('country')?.invalid"
            class="error-message">
            País é obrigatório.
          </div>
        </div>

      </div>

      <!-- Seção 3: Dados de Trabalho -->
      <div class="form-section">
        <h3>Dados de Trabalho</h3>

        <!-- Campo Cargo -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('position')?.touched && employeeForm.get('position')?.invalid}">
          <label for="position">Cargo <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">work</mat-icon>
            <select id="position" formControlName="position">
              <option *ngFor="let position of positions" [value]="position">{{ position }}</option>
            </select>
          </div>
          <div *ngIf="employeeForm.get('position')?.touched && employeeForm.get('position')?.invalid"
            class="error-message">
            Cargo é obrigatório.
          </div>
        </div>

        <!-- Campo Salário -->
        <div class="form-group"
          [ngClass]="{'has-error': employeeForm.get('wage')?.touched && employeeForm.get('wage')?.invalid}">
          <label for="wage">Salário <span class="required">*</span></label>
          <div class="input-with-icon">
            <mat-icon class="leading-icon">attach_money</mat-icon>
            <input id="wage" formControlName="wage" type="text" placeholder="Salário">
          </div>
          <div *ngIf="employeeForm.get('wage')?.touched && employeeForm.get('wage')?.invalid" class="error-message">
            Salário é obrigatório.
          </div>
        </div>
      </div>
    </div>

    <button type="submit" class="btn-save" [disabled]="employeeForm.invalid || loading">
      Cadastrar Funcionário
    </button>
  </form>
</div>
